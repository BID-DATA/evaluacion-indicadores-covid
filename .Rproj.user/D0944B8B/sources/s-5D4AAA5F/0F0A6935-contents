# Pobreza y protección social

En esta sección se consideran los indicadores de porcentaje de la población viviendo en pobreza, con vulnerabilidad, recibiendo remesas, así como el coeficiente de Gini. 

```{r indicadores graficas, include=FALSE}

source("Indicadores funciones.R")


promedio_list <-list()

promedio_plots <-list()

consulta <- scldataR::scldata_dict %>% 
  select(collection, indicator, label_es) %>% 
  filter(indicator == 'pobreza' | indicator == 'vulnerable' | indicator == 'ginihh'| indicator == 'indexrem')

vars <- set_names(consulta$indicator) 

##### Promedios

for (i in names(vars)) {

promedio_list[[i]] <- query_indicator(indicator = i, 
                                      countries = 'COL,ARG,PRY,ECU,MEX,CRI,SLV,BOL,PER,CHL,BRA') %>% 
  mutate(year = case_when(year == 2017 & isoalpha3 == "CHL" ~ 2019, 
                          year == 2018 & isoalpha3 == "MEX" ~2019, 
                          TRUE ~ year)) %>% 
  rbind(grouped_mean(., value, year)) %>% 
  ungroup() %>% 
  group_by(isoalpha3) %>% 
  arrange(isoalpha3, year) %>% 
  mutate(change_pp = value - lag(value)) %>% 
  filter(year == 2020) 

promedio_plots[[i]] <- ggfun_prom(promedio_list[[i]], promedio_list[[i]]$isoalpha3, promedio_list[[i]]$change_pp)

}

##### Evolución 

evolucion_list <-list()

evolucion_plots <-list()

for (i in names(vars)) {

evolucion_list[[i]] <- query_indicator(indicator = i, 
                                      countries = 'COL,ARG,PRY,ECU,MEX,CRI,SLV,BOL,PER,CHL,BRA') %>% 
  mutate(year = case_when(year == 2017 & isoalpha3 == "CHL" ~ 2019, 
                          year == 2018 & isoalpha3 == "MEX" ~2019, 
                          TRUE ~ year)) %>% 
  left_join(paises)

evolucion_plots[[i]] <- ggfun_evo(evolucion_list[[i]], evolucion_list[[i]]$year, evolucion_list[[i]]$value)

}

##### Categoria una

categoria_list <-list()

categoria_plots <-list()

for (i in names(vars)) {

categoria_list[[i]] <- query_indicator(indicator = i, 
                                       categories = 'area',
                                       countries = 'COL,ARG,PRY,ECU,MEX,CRI,SLV,BOL,PER,CHL,BRA') %>% 
  mutate(year = case_when(year == 2017 & isoalpha3 == "CHL" ~ 2019, 
                          year == 2018 & isoalpha3 == "MEX" ~2019, 
                          TRUE ~ year)) %>% 
  rbind(grouped_mean(., value, area, year)) %>% 
  ungroup() %>% 
  group_by(isoalpha3, area) %>% 
  arrange(isoalpha3, year) %>% 
  mutate(change_pp = value - lag(value)) %>% 
  filter(year == 2020) 

categoria_plots[[i]] <- ggfun_one(categoria_list[[i]], categoria_list[[i]]$isoalpha3, categoria_list[[i]]$change_pp, categoria_list[[i]]$area)

}

#### Table 

table <- query_indicator(indicator = 'pobreza,vulnerable,ginihh,indexrem') %>% 
      rbind(grouped_mean(., value, indicator, year)) %>% 
      ungroup() %>% 
  select(country_name_es, year, indicator, value) %>% 
  spread(indicator, value) %>% 
  rename_all(funs(c('País', 'Año', 'Gini', 'Remesas', 'Población en pobreza', 'Población vulnerable'))) 

```

Como análisis general se presenta un overview de los indicadores cubiertos en esta sección para los años para los que se cuenta información. En contraste con el resto de la sección, este resumen general se presenta para todos los paises, y no únicamente para los que tienen datos en 2020.

Table \@ref(fig:pobTab): Tabla de indicadores pobreza y protección social

```{r pobTab, fig.cap="A table", echo=FALSE, warning=FALSE, show_col_types = FALSE}

  table %>% 
  DT::datatable(., rownames = FALSE, 
                filter = 'top', 
                width = 825, 
                options = list(pageLength = 20,
                                scrollX = TRUE,
                                searching = TRUE,
                                lengthMenu = c(10,20,30,40,50),
                                columnDefs = list(list(className = 'dt-center', targets = 0:5)))) %>% 
   DT::formatRound(table = ., columns = c('Gini', 'Remesas', 'Población en pobreza', 'Población vulnerable'), digits = 2) %>%
   DT::formatStyle(0:5,color = '#002126')


```

### Evolucion

```{r pob-evo, results='asis', echo=FALSE}

print(evolucion_plots$pobreza)

```

### Cambios promedio

```{r pob, results='asis', echo=FALSE}

print(promedio_plots$pobreza)

```

### Por area 

```{r pob area, results='asis', echo=FALSE}

print(categoria_plots$pobreza)

```

## Vulnerable

### Evolucion

```{r vul evo, results='asis', echo=FALSE}

print(evolucion_plots$pobreza)

```

### Cambios promedio

```{r vul, results='asis', echo=FALSE}

print(promedio_plots$vulnerable)

```

### Por area 

```{r vul area, results='asis', echo=FALSE}

print(categoria_plots$vulnerable)

```

## Gini

### Evolucion

```{r gini evo, results='asis', echo=FALSE}

print(evolucion_plots$gini)

```

### Cambios promedio

```{r gin prom, results='asis', echo=FALSE}

print(promedio_plots$ginihh)

```

### Por area 

```{r gin area, results='asis', echo=FALSE}

print(categoria_plots$ginihh)

```

## Remesas

### Evolucion

```{r rem evo, results='asis', echo=FALSE}

print(evolucion_plots$indexrem)

```

### Cambios promedio

```{r rem prom, results='asis', echo=FALSE}

print(promedio_plots$indexrem)

```

### Por area 

```{r rem area, results='asis', echo=FALSE}

print(categoria_plots$indexrem)

```


